<h1>User Management</h1>

<table border="1" cellpadding="10" cellspacing="0" style="width: 100%; text-align: center; margin-bottom: 10px;">
    <thead>
        <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Role</th>
            <th>Actions</th>
            <th>Delete</th>
        </tr>
    </thead>
    <tbody>
        {% for user in users %}
        <tr id="row_{{ user.id }}">
            <form method="POST" action="{{ url_for('user.manage_users') }}" id="form_{{ user.id }}">
                <td>
                    {{ user.id }}
                    <input type="hidden" name="user_id" value="{{ user.id }}">
                </td>
                <td>
                    <span class="text" id="username_text_{{ user.id }}">{{ user.username }}</span>
                    <input class="edit" type="text" name="username" value="{{ user.username }}" style="display:none;">
                </td>
                <td>
                    <span class="text" id="email_text_{{ user.id }}">{{ user.email }}</span>
                    <input class="edit" type="email" name="email" value="{{ user.email }}" style="display:none;">
                </td>
                <td>
                    <span class="text" id="phone_text_{{ user.id }}">{{ user.phone }}</span>
                    <input class="edit" type="text" name="phone" value="{{ user.phone }}" style="display:none;">
                </td>
                <td>
                    <span class="text" id="role_text_{{ user.id }}">{{ user.role }}</span>
                    <select class="edit" name="role" style="display:none;">
                        <option value="user" {% if user.role == 'user' %}selected{% endif %}>User</option>
                        <option value="admin" {% if user.role == 'admin' %}selected{% endif %}>Admin</option>
                    </select>
                </td>
                <td>
                    <button type="button" onclick="enableEdit({{ user.id }})" id="update_btn_{{ user.id }}">Update</button>
                    <button type="submit" style="display:none;" id="save_btn_{{ user.id }}">Save</button>
                </td>
            </form>
            <form method="POST" action="{{ url_for('user.manage_users') }}" style="display:inline;">
                <td>
                    <input type="hidden" name="delete_user" value="{{ user.id }}">
                    <button type="submit" onclick="return confirmDelete()" style="background-color:red; color:white;">Delete</button>

                </td>
            </form>
        </tr>
        {% endfor %}
    </tbody>
</table>

<br><br>

<!-- Add New User -->
<h2>Add New User</h2>
<form method="POST" action="{{ url_for('user.manage_users') }}">
    <table border="1" cellpadding="10" cellspacing="0" style="width: 60%; text-align: center;">
        <tr style="background-color: #e0f7fa;">
            <td><input type="text" name="new_username" placeholder="New Username" required></td>
            <td><input type="email" name="new_email" placeholder="New Email" required></td>
            <td><input type="text" name="new_phone" placeholder="New Phone"></td>
            <td>
                <select name="new_role">
                    <option value="user" selected>User</option>
                    <option value="admin">Admin</option>
                </select>
            </td>
            <td><input type="password" name="new_password" placeholder="Password" required></td>
            <td><button type="submit" name="add_user" value="true">Add</button></td>
        </tr>
    </table>
</form>

<!-- JavaScript -->
<script>
function enableEdit(userId) {
    const row = document.getElementById('row_' + userId);
    const updateBtn = document.getElementById('update_btn_' + userId);
    const saveBtn = document.getElementById('save_btn_' + userId);

    const texts = row.querySelectorAll('.text');
    const edits = row.querySelectorAll('.edit');

    texts.forEach(t => t.style.display = 'none');
    edits.forEach(e => e.style.display = 'inline-block');

    updateBtn.style.display = 'none';
    saveBtn.style.display = 'inline-block';
}

function confirmDelete() {
    return confirm('Are you sure you want to delete this user?');
}
</script>
